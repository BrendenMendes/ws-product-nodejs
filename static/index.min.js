var option,myChart,stackedBar={};function loadChart(){let e=document.getElementById("myChart").getContext("2d");myChart&&(myChart=null),myChart=new Chart(e,{type:"bar",data:stackedBar,options:{scales:{xAxes:[{stacked:!0}],yAxes:[{stacked:!0}]}}})}function addData(e,a,t){e.data.labels.push(a),e.data.datasets.forEach(e=>{e.data.push(t)}),e.update()}function removeData(e){e.data.labels.pop(),e.data.datasets.forEach(e=>{e.data.pop()}),e.update(),console.log(e)}$(function(){$("#options :input").change(function(){option=this.id,console.log(option),$("#search-data").prop("disabled",!1)}),$("#search-data").click(async function(){let e=new Date($("#from-option").val()),a=new Date($("#to-input-option").val());e.getTime()<a.getTime()?(removeData(myChart),removeData(myChart),removeData(myChart),removeData(myChart),removeData(myChart),removeData(myChart),removeData(myChart),await function(e,a,t){console.log(a,t),"events"==e?$.ajax("/events/"+a+"/"+t,{type:"GET",success:function(e,a,t){if(e.length>0){let a=[],t=[],o=[],n=[],r=[],s=0,l=0,c=0,i=0;for(let d=0;d<e.length;d++)a.push(e[d].date.replace("T05:00:00.000Z","")),e.indexOf(e[d])+1!=e.length&&e[d].date==e[d+1].date?e[d].hour<6?s+=e[d].events:e[d].hour<12?l+=e[d].events:e[d].hour<18?c+=e[d].events:i+=e[d].events:(e[d].hour<6?s+=e[d].events:e[d].hour<12?l+=e[d].events:e[d].hour<18?c+=e[d].events:i+=e[d].events,r.push(s),t.push(l),o.push(c),n.push(i),s=0,l=0,c=0,i=0);a=[...new Set(a)],stackedBar={labels:a,datasets:[{label:"night (12am - 6am)",data:r,backgroundColor:"rgb(75, 192, 192)"},{label:"morning (6am - 12pm)",data:t,backgroundColor:"rgb(255, 205, 86)"},{label:"afternoon (12pm - 6pm)",data:o,backgroundColor:"rgb(255, 99, 132)"},{label:"evening (6pm - 12am)",data:n,backgroundColor:"rgb(54, 162, 235)"}]},console.log(stackedBar),loadChart()}else alert("no data present")},error:function(e,a,t){alert("issue with system")}}):(console.log(a,t),$.ajax("/stats/"+a+"/"+t,{type:"GET",success:function(e,a,t){if(console.log(e),e.length>0){let a=[],t=[],o=[],n=[];for(let r=0;r<e.length;r++)a.push(e[r].date.replace("T05:00:00.000Z","")),t.push(e[r].impressions),o.push(e[r].clicks),n.push(e[r].revenue);a=[...new Set(a)],stackedBar={},stackedBar={labels:a,datasets:[{label:"impressions",data:t,backgroundColor:"rgb(54, 162, 235)"},{label:"clicks",data:o,backgroundColor:"rgb(255, 205, 86)"},{label:"revenue",data:n,backgroundColor:"rgb(255, 99, 132)"}]},loadChart()}else alert("no data present")},error:function(e,a,t){alert("issue with system")}}))}(option,$("#from-option").val().replace("-","").replace("-",""),$("#to-input-option").val().replace("-","").replace("-",""))):alert("Enter a valid date range")}),$("#search-bar").on("input",function(){let e=this.value;$.ajax("/poi",{type:"POST",data:JSON.stringify({query:e}),contentType:"application/json; charset=utf-8",success:function(e,a,t){var o=document.getElementById("search-results");o.innerHTML="",e.forEach(e=>{o.insertRow(0).innerHTML=e.item.name})},error:function(e,a,t){}})})});